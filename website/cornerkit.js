var e,t;e=this,t=function(e){var t,r;e.RendererTier=void 0,(t=e.RendererTier||(e.RendererTier={})).NATIVE="native",t.HOUDINI="houdini",t.CLIPPATH="clippath",t.FALLBACK="fallback";class i{constructor(){this.cachedSupport=null}static getInstance(){return i.instance||(i.instance=new i),i.instance}supports(){return this.cachedSupport||(this.cachedSupport={native:this.detectNative(),houdini:this.detectHoudini(),clippath:this.detectClipPath(),fallback:!0}),this.cachedSupport}detectTier(){const t=this.supports();return t.native?e.RendererTier.NATIVE:t.houdini?e.RendererTier.HOUDINI:t.clippath?e.RendererTier.CLIPPATH:e.RendererTier.FALLBACK}detectNative(){if("undefined"==typeof CSS||!CSS.supports)return!1;try{return CSS.supports("corner-shape","squircle")}catch{return!1}}detectHoudini(){if("undefined"==typeof CSS)return!1;try{return"paintWorklet"in CSS}catch{return!1}}detectClipPath(){if("undefined"==typeof CSS)return!1;if(CSS.supports)try{if(CSS.supports("clip-path",'path("")'))return!0}catch{}try{if("undefined"!=typeof document){const e=document.createElement("div");return e.style.clipPath="path('M 0,0 L 10,0 L 10,10 L 0,10 Z')",""!==e.style.clipPath}}catch{return!1}return!1}static supports(){return i.getInstance().supports()}}i.instance=null,(e=>{e.WARN="warn",e.ERROR="error",e.INFO="info"})(r||(r={}));class n{constructor(){this.elements=new WeakMap,this.trackedElements=new Set}register(e,t,r,i,n,s){if(this.has(e)){const o=this.get(e);if(o)return o.resizeObserver&&"cleanup"in o.resizeObserver&&o.resizeObserver.cleanup(),o.resizeObserver?.disconnect(),o.intersectionObserver?.disconnect(),o.config=t,o.tier=r,o.resizeObserver=i,o.intersectionObserver=n,o.lastDimensions={width:e.offsetWidth,height:e.offsetHeight},void(!o.originalStyles&&s&&(o.originalStyles=s))}this.elements.set(e,{element:e,config:t,tier:r,resizeObserver:i,intersectionObserver:n,lastDimensions:{width:e.offsetWidth,height:e.offsetHeight},originalStyles:s}),this.trackedElements.add(e)}get(e){return this.elements.get(e)}has(e){return this.elements.has(e)}delete(e){const t=this.get(e);t&&(t.resizeObserver&&"cleanup"in t.resizeObserver&&t.resizeObserver.cleanup(),t.resizeObserver?.disconnect(),t.intersectionObserver?.disconnect(),this.elements.delete(e),this.trackedElements.delete(e))}update(e,t){const r=this.get(e);if(r)return r.config={...r.config,...t},r}updateDimensions(e,t,r){const i=this.get(e);i&&(i.lastDimensions={width:t,height:r})}getAllElements(){return Array.from(this.trackedElements).filter(e=>this.has(e))}clear(){Array.from(this.trackedElements).forEach(e=>{this.delete(e)})}}const s={radius:20,smoothing:.8};function o(e){return e*Math.PI/180}function a(e,t){const r=(1+t)*e,i=90*(1-t),n=Math.sin(o(i/2))*e*Math.sqrt(2),s=45*t,a=e*Math.tan(o((90-i)/2/2))*Math.cos(o(s)),c=a*Math.tan(o(s)),l=(r-n-a-c)/3;return{a:2*l,b:l,c:a,d:c,p:r,arcSectionLength:n,cornerRadius:e}}function c(e){return Math.round(100*e)/100}function l(e){return Math.round(100*e)/100}function h(e,t=20){return"number"!=typeof e||isNaN(e)||!isFinite(e)||e<0?t:e}function d(e,t=.8){return"number"!=typeof e||isNaN(e)||!isFinite(e)?t:e<0?0:e>1?1:e}class u{apply(e,t,r,i,n){r?.reducedMotion&&this.applyReducedMotion(e),this.updateClipPath(e,t);const s=this.createResizeObserver(e,i,n);return s.observe(e),s}update(e,t){this.updateClipPath(e,t)}remove(e,t){e.style.clipPath="",void 0!==t&&(e.style.transition=t)}updateClipPath(e,t){const{radius:r,smoothing:i}=t,n=e.offsetWidth,s=e.offsetHeight;if(n<1||s<1)return;const o=((e,t,r,i=.6)=>e<=0||t<=0||r<=0?`M 0,0 L ${l(e)},0 L ${l(e)},${l(t)} L 0,${l(t)} Z`:((e,t,r,i=.6)=>{const n=Math.min(r,e/2,t/2),s=Math.max(0,Math.min(1,i)),o=a(n,s),l=a(n,s),h=a(n,s),d=a(n,s);return`\n    M ${c(e-l.p)} 0\n    ${(e=>{const{cornerRadius:t,a:r,b:i,c:n,d:s,arcSectionLength:o}=e;return 0===t?`l ${c(e.p)} 0`:`\n    c ${c(r)} 0 ${c(r+i)} 0 ${c(r+i+n)} ${c(s)}\n    a ${c(t)} ${c(t)} 0 0 1 ${c(o)} ${c(o)}\n    c ${c(s)} ${c(n)} ${c(s)} ${c(i+n)} ${c(s)} ${c(r+i+n)}\n  `.trim().replace(/\s+/g," ")})(l)}\n    L ${c(e)} ${c(t-h.p)}\n    ${(e=>{const{cornerRadius:t,a:r,b:i,c:n,d:s,arcSectionLength:o}=e;return 0===t?"l 0 "+c(e.p):`\n    c 0 ${c(r)} 0 ${c(r+i)} ${c(-s)} ${c(r+i+n)}\n    a ${c(t)} ${c(t)} 0 0 1 ${c(-o)} ${c(o)}\n    c ${c(-n)} ${c(s)} ${c(-i-n)} ${c(s)} ${c(-r-i-n)} ${c(s)}\n  `.trim().replace(/\s+/g," ")})(h)}\n    L ${c(d.p)} ${c(t)}\n    ${(e=>{const{cornerRadius:t,a:r,b:i,c:n,d:s,arcSectionLength:o}=e;return 0===t?`l ${c(-e.p)} 0`:`\n    c ${c(-r)} 0 ${c(-r-i)} 0 ${c(-r-i-n)} ${c(-s)}\n    a ${c(t)} ${c(t)} 0 0 1 ${c(-o)} ${c(-o)}\n    c ${c(-s)} ${c(-n)} ${c(-s)} ${c(-i-n)} ${c(-s)} ${c(-r-i-n)}\n  `.trim().replace(/\s+/g," ")})(d)}\n    L 0 ${c(o.p)}\n    ${(e=>{const{cornerRadius:t,a:r,b:i,c:n,d:s,arcSectionLength:o}=e;return 0===t?"l 0 "+c(-e.p):`\n    c 0 ${c(-r)} 0 ${c(-r-i)} ${c(s)} ${c(-r-i-n)}\n    a ${c(t)} ${c(t)} 0 0 1 ${c(o)} ${c(-o)}\n    c ${c(n)} ${c(-s)} ${c(i+n)} ${c(-s)} ${c(r+i+n)} ${c(-s)}\n  `.trim().replace(/\s+/g," ")})(o)}\n    Z\n  `.replace(/\s+/g," ").trim()})(e,t,r,i))(n,s,r,i);e.style.clipPath=`path('${o}')`}applyReducedMotion(e){const t=e.style.transition||"";t.includes("clip-path")||(e.style.transition=t?t+", clip-path 0s":"clip-path 0s")}createResizeObserver(e,t,r){let i=e.offsetWidth,n=e.offsetHeight,s=null;const o=new ResizeObserver(e=>{null!==s&&cancelAnimationFrame(s),s=requestAnimationFrame(()=>{for(const s of e)try{const e=s.target,o=e.offsetWidth,a=e.offsetHeight;if(Math.abs(o-i)>=1||Math.abs(a-n)>=1){const s=r?r():{radius:0,smoothing:.8};this.updateClipPath(e,s),t?.(e,o,a),i=o,n=a}}catch(e){o.disconnect()}s=null})}),a=o;return a.cleanup=()=>{null!==s&&(cancelAnimationFrame(s),s=null)},a}}class p{apply(e,t){this.updateBorderRadius(e,t)}update(e,t){this.updateBorderRadius(e,t)}remove(e){e.style.borderRadius=""}updateBorderRadius(e,t){const{radius:r}=t;e.style.borderRadius=r+"px"}}function f(e){const t=e.getAttribute("data-squircle-radius");if(null===t)return;const r=parseFloat(t);return Number.isNaN(r)?void 0:r}function g(e){const t=e.getAttribute("data-squircle-smoothing");if(null===t)return;const r=parseFloat(t);return Number.isNaN(r)?void 0:r}function m(e){const t={},r=f(e);void 0!==r&&(t.radius=r);const i=g(e);return void 0!==i&&(t.smoothing=i),t}e.DEFAULT_CONFIG=s,e.default=class{constructor(e){this.globalConfig={...s,...e},this.globalConfig.radius=h(this.globalConfig.radius),this.globalConfig.smoothing=d(this.globalConfig.smoothing),this.detector=i.getInstance(),this.registry=new n,this.reducedMotionEnabled=!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.reducedMotionWatcher=(e=>{if("undefined"==typeof window||!window.matchMedia)return()=>{};const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=t=>{e(t.matches)};return t.addEventListener?t.addEventListener("change",r):t.addListener&&t.addListener(r),()=>{t.removeEventListener?t.removeEventListener("change",r):t.removeListener&&t.removeListener(r)}})(e=>{this.reducedMotionEnabled=e,this.updateAllReducedMotion()})}apply(t,r){const i=this.resolveElement(t),n={radius:h(r?.radius??this.globalConfig.radius),smoothing:d(r?.smoothing??this.globalConfig.smoothing),tier:r?.tier??this.globalConfig.tier};let s=n.tier||this.detector.detectTier();s!==e.RendererTier.NATIVE&&s!==e.RendererTier.HOUDINI||(s=e.RendererTier.CLIPPATH);const o=i.style.transition;if(s===e.RendererTier.CLIPPATH){this.clipPathRenderer||(this.clipPathRenderer=new u);const e=this.clipPathRenderer.apply(i,n,{reducedMotion:this.reducedMotionEnabled},(e,t,r)=>{this.registry.updateDimensions(e,t,r)},()=>{const e=this.registry.get(i);return e?e.config:n});this.registry.register(i,n,s,e,void 0,{transition:o})}else this.fallbackRenderer||(this.fallbackRenderer=new p),this.fallbackRenderer.apply(i,n),this.registry.register(i,n,s,void 0,void 0,{transition:o})}applyAll(e,t){if("string"!=typeof e)throw new TypeError("cornerKit: Selector must be a string, got "+typeof e);if(""===e.trim())throw new TypeError("cornerKit: Selector must be a non-empty string");try{const r=document.querySelectorAll(e);if(0===r.length)return;r.forEach(e=>{e instanceof HTMLElement&&this.apply(e,t)})}catch(t){if(t instanceof DOMException||"SyntaxError"===t.name)throw new TypeError(`cornerKit: Invalid CSS selector: "${e}"`);throw t}}auto(){const e=document.querySelectorAll("[data-squircle]");if(0===e.length)return;this.autoObserver&&(this.autoObserver.disconnect(),this.autoObserver=void 0);const t=[];e.forEach(e=>{if(!(e instanceof HTMLElement))return;if(this.registry.has(e))return;const r=m(e),i=e.getBoundingClientRect();i.top>=-50&&i.left>=-50&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)+50&&i.right<=(window.innerWidth||document.documentElement.clientWidth)+50?this.apply(e,r):t.push(e)}),t.length>0&&(this.autoObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&e.target instanceof HTMLElement){const t=e.target;if(this.registry.has(t))return void this.autoObserver?.unobserve(t);const r=m(t);this.apply(t,r),this.autoObserver?.unobserve(t)}})},{rootMargin:"50px"}),t.forEach(e=>{this.autoObserver.observe(e)}))}update(e,t){const r=this.resolveElement(e);if(!this.registry.get(r))throw Error("cornerKit: Cannot update element - element is not managed by CornerKit. Call apply() first.");const i={};if(void 0!==t.radius&&(i.radius=h(t.radius)),void 0!==t.smoothing&&(i.smoothing=d(t.smoothing)),void 0!==t.tier&&(i.tier=t.tier),0===Object.keys(i).length)return;const n=this.registry.update(r,i);if(!n)throw Error("cornerKit: Internal error - failed to update registry");this.updateElementStyling(r,n.config,n.tier)}remove(e){const t=this.resolveElement(e),r=this.registry.get(t);if(!r)throw Error("cornerKit: Cannot remove element - element is not managed by CornerKit. Element may have already been removed or never had squircle applied.");this.removeElementStyling(t,r.tier,r.originalStyles?.transition),this.registry.delete(t)}destroy(){this.registry.getAllElements().forEach(e=>{const t=this.registry.get(e);t&&this.removeElementStyling(e,t.tier,t.originalStyles?.transition)}),this.registry.clear(),this.autoObserver&&(this.autoObserver.disconnect(),this.autoObserver=void 0),this.reducedMotionWatcher&&(this.reducedMotionWatcher(),this.reducedMotionWatcher=void 0)}inspect(e){try{const t=this.resolveElement(e),r=this.registry.get(t);return r?{config:{...r.config},tier:r.tier,dimensions:{width:r.lastDimensions?.width??t.offsetWidth,height:r.lastDimensions?.height??t.offsetHeight}}:null}catch(e){return null}}removeElementStyling(t,r,i){r===e.RendererTier.CLIPPATH?(this.clipPathRenderer||(this.clipPathRenderer=new u),this.clipPathRenderer.remove(t,i)):(this.fallbackRenderer||(this.fallbackRenderer=new p),this.fallbackRenderer.remove(t),void 0!==i&&(t.style.transition=i))}updateElementStyling(t,r,i){i===e.RendererTier.CLIPPATH?(this.clipPathRenderer||(this.clipPathRenderer=new u),this.clipPathRenderer.update(t,r)):(this.fallbackRenderer||(this.fallbackRenderer=new p),this.fallbackRenderer.update(t,r))}updateAllReducedMotion(){this.registry.getAllElements().forEach(t=>{const r=this.registry.get(t);if(!r||r.tier!==e.RendererTier.CLIPPATH)return;this.clipPathRenderer||(this.clipPathRenderer=new u);const i=t.style.transition||"";if(this.reducedMotionEnabled)i.includes("clip-path")||(t.style.transition=i?i+", clip-path 0s":"clip-path 0s");else if(i.includes("clip-path 0s")){const e=i.split(",").map(e=>e.trim()).filter(e=>!e.startsWith("clip-path")).join(", ");t.style.transition=e||(r.originalStyles?.transition??"")}})}resolveElement(e){if("string"!=typeof e){if(!(e instanceof HTMLElement))throw new TypeError("cornerKit: Expected HTMLElement or string, got "+typeof e);return e}const t=e;if(""===t.trim())throw new TypeError("cornerKit: Selector must be a non-empty string");try{const e=document.querySelector(t);if(!e)throw Error(`cornerKit: Selector "${t}" matched 0 elements`);if(!(e instanceof HTMLElement))throw new TypeError(`cornerKit: Selector "${t}" must match an HTMLElement, got ${e.constructor.name}`);return document.querySelectorAll(t),e}catch(e){if(e instanceof DOMException||"SyntaxError"===e.name)throw new TypeError(`cornerKit: Invalid CSS selector: "${t}"`);throw e}}static supports(){const e=i.getInstance().supports();return{native:e.native,houdini:e.houdini,clippath:e.clippath,fallback:e.fallback}}},e.hasSquircleAttribute=e=>e.hasAttribute("data-squircle"),e.parseDataAttributes=m,e.parseRadius=f,e.parseSmoothing=g,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CornerKit={});
//# sourceMappingURL=cornerkit.js.map
